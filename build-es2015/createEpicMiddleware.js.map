{"version":3,"sources":["../src/createEpicMiddleware.ts"],"names":[],"mappings":";AAMA,oCAAkC,qBAAqB,CAAC,CAAA;AACxD,2BAAyB,YAAY,CAAC,CAAA;AAMtC,0BAAwB,cAAc,CAAC,CAAA;AACvC,QAAO,qBAAqB,CAAC,CAAA;AAC7B,sBAAoB,mBAAmB,CAAC,CAAA;AACxC,4BAA0B,yBAAyB,CAAC,CAAA;AAEpD,MAAM,cAAc,GAAiB;IACnC,KAAK,EAAE,CAAC,OAAY,KAAK,OAAO;IAChC,MAAM,EAAE,CAAC,OAAY,KAAK,OAAO;CAClC,CAAC;AAKF,MAAM,cAAc,GAAG;IACrB,OAAO,EAAE,cAAc;CACxB,CAAC;AAEF,8BACE,IAAiC,EAAE,EAAE,OAAO,GAAG,cAAc,EAAE,GAAoB,cAAc;IAEjG,EAAE,CAAC,CAAC,OAAO,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC;QAC/B,MAAM,IAAI,SAAS,CAAC,sDAAsD,CAAC,CAAC;IAC9E,CAAC;IAED,MAAM,MAAM,GAAG,IAAI,iBAAO,EAAE,CAAC;IAC7B,MAAM,OAAO,GAA+B,OAAO,CAAC,KAAK,CACvD,IAAI,qCAAiB,CAAC,MAAM,CAAC,CAC9B,CAAC;IACF,MAAM,KAAK,GAAG,IAAI,iBAAO,EAAE,CAAC;IAC5B,gCAAgC;IAChC,4CAA4C;IAE5C,IAAI,KAAiB,CAAC;IACtB,MAAM,cAAc,GAAG,CAAC,MAAkB;QACxC,KAAK,GAAG,MAAM,CAAC;QAEf,MAAM,CAAC,CAAC,IAAuB;YAC7B,KAAK;iBACF,QAAQ,CAAC,SAAG,EAAE,CAAC,OAAwB,KAAK,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;iBACpE,QAAQ,CAAC,qBAAS,EAAE,CAAC,UAAsC,KAAK,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;iBAC3F,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YAE7B,0BAA0B;YAC1B,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAEjB,MAAM,CAAC,CAAC,MAAe;gBACrB,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC5B,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACpB,MAAM,CAAC,MAAM,CAAC;YAChB,CAAC,CAAC;QACJ,CAAC,CAAC;IACJ,CAAC,CAAC;IAED,cAAsB,CAAC,WAAW,GAAG,CAAC,QAAqC;QAC1E,6CAA6C;QAC7C,sBAAsB;QACtB,KAAK,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,mBAAQ,EAAE,CAAC,CAAC;QACnC,2DAA2D;QAC3D,mBAAmB;QACnB,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACvB,CAAC,CAAC;IAEF,MAAM,CAAC,cAAuD,CAAC;AACjE,CAAC;AA9Ce,4BAAoB,uBA8CnC,CAAA","file":"createEpicMiddleware.js","sourcesContent":["/* tslint:disable: variable-name */\nimport { Action } from 'redux-actions';\nimport {\n  Store,\n  Dispatch,\n} from 'redux';\nimport { ActionsObservable } from './ActionsObservable';\nimport { EPIC_END } from './EPIC_END';\nimport {\n  IEpicAdapter,\n  IEpic,\n  IEpicMiddleware,\n} from './model';\nimport { Subject } from 'rxjs/Subject';\nimport './rxjs/add/__invoke';\nimport { map } from 'rxjs/operator/map';\nimport { switchMap } from 'rxjs/operator/switchMap';\n\nconst defaultAdapter: IEpicAdapter = {\n  input: (action$: any) => action$,\n  output: (action$: any) => action$,\n};\n\nexport interface IDefaultOptions {\n  adapter: IEpicAdapter;\n}\nconst defaultOptions = {\n  adapter: defaultAdapter,\n};\n\nexport function createEpicMiddleware<TAction extends Action<any>, TStoreState>(\n  epic: IEpic<TAction, TStoreState>, { adapter = defaultAdapter }: IDefaultOptions = defaultOptions\n) {\n  if (typeof epic !== 'function') {\n    throw new TypeError('You must provide a root Epic to createEpicMiddleware');\n  }\n\n  const input$ = new Subject();\n  const action$: ActionsObservable<TAction> = adapter.input(\n    new ActionsObservable(input$)\n  );\n  const epic$ = new Subject();\n  // const eMap = map.bind(epic$);\n  // const eSwitchMap = switchMap.bind(epic$);\n\n  let store: Store<any>;\n  const epicMiddleware = (_store: Store<any>) => {\n    store = _store;\n\n    return (next: Dispatch<TAction>) => {\n      epic$\n        .__invoke(map, (epicArg: IEpic<any, any>) => epicArg(action$, store))\n        .__invoke(switchMap, (actionArg$: ActionsObservable<TAction>) => adapter.output(actionArg$))\n        .subscribe(store.dispatch);\n\n      // Setup initial root epic\n      epic$.next(epic);\n\n      return (action: TAction) => {\n        const result = next(action);\n        input$.next(action);\n        return result;\n      };\n    };\n  };\n\n  (epicMiddleware as any).replaceEpic = (nextEpic: IEpic<TAction, TStoreState>) => {\n    // gives the previous root Epic a last chance\n    // to do some clean up\n    store.dispatch({ type: EPIC_END });\n    // switches to the new root Epic, synchronously terminating\n    // the previous one\n    epic$.next(nextEpic);\n  };\n\n  return epicMiddleware as IEpicMiddleware<TAction, TStoreState>;\n}\n"],"sourceRoot":"/source/"}